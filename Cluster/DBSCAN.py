import numpy as np
from sklearn.cluster import DBSCAN
import matplotlib.pyplot as plt

# Dữ liệu lat lon
data = [
    [10.79873893, 106.58475074],
    [10.76494905, 106.63425263],
    [10.80654415, 106.63419073],
    [10.76407979, 106.57976891],
    [10.7400531, 106.73387648],
    [10.79008932, 106.64003442],
    [10.82361435, 106.68602501],
    [10.76510526, 106.60136309],
    [10.754276, 106.65038487],
    [10.73252319, 106.70693794],
    [10.77968236, 106.63120246],
    [10.82526124, 106.70667993],
    [10.73769961, 106.72571768],
    [10.82866704, 106.67410763],
    [10.77849179, 106.66544417],
    [10.7410835, 106.70203763],
    [10.82395543, 106.69219394],
    [10.83674148, 106.68341207],
    [10.83382762, 106.67059324],
    [10.92673758, 106.55686148],
    [10.74950402, 106.65453533],
    [10.95901629, 106.50469228],
    [10.7547127, 106.633261],
    [10.69472676, 106.58839643],
    [10.86442298, 106.58982154],
    [10.76906319, 106.65309533],
    [10.73935071, 106.62920119],
    [10.76761123, 106.68591328],
    [10.76904968, 106.6657765],
    [10.75364472, 106.6133353],
    [10.82728301, 106.81193994],
    [10.76295414, 106.65702261],
    [10.75631753, 106.69231771],
    [10.80530015, 106.67858332],
    [10.75511243, 106.69004244],
    [10.6855854, 106.62249707],
    [10.79623274, 106.7405364],
    [10.74838756, 106.70536196],
    [10.82428508, 106.68272749],
    [10.83493002, 106.66219502],
    [10.82608672, 106.81733426],
    [10.86822489, 106.73579149],
    [10.73663306, 106.61394474],
    [10.76027751, 106.66189974],
    [10.74433337, 106.65502917],
    [10.85905418, 106.77776524],
    [10.80140875, 106.61857143],
    [10.82793967, 106.72155997],
    [10.8009655, 106.65353683],
    [10.7495301, 106.7084913],
    [10.75422204, 106.65166155],
    [10.7854681, 106.64193117],
    [10.8345276, 106.66475696],
    [10.83091125, 106.61499504],
    [10.66685789, 106.72514617],
    [10.75313396, 106.70073883],
    [10.81524199, 106.67207383],
    [10.63321175, 106.76237679],
    [10.77569148, 106.63053734],
    [10.78796334, 106.699553],
    [10.77059664, 106.66947987],
    [10.78661084, 106.64514608],
    [10.80091801, 106.65822372],
    [10.79501296, 106.72188185],
    [10.73380934, 106.70672371],
    [10.71850927, 106.74344459],
    [10.82839675, 106.62040336],
    [10.79911036, 106.68928578],
    [10.84141666, 106.74553243],
    [10.74285159, 106.61222465],
    [10.69713383, 106.59701609],
    [10.88967811, 106.59629605],
    [10.79777172, 106.65901639],
    [10.73362232, 106.67453329],
    [10.80604494, 106.66638702],
    [10.73155845, 106.6042846],
    [10.78684742, 106.67529388],
    [10.77469691, 106.67481141],
    [10.77034333, 106.6292236],
    [10.77184099, 106.67001309],
    [10.76848879, 106.6680193],
    [10.89545954, 106.62185635],
    [10.75422933, 106.66689835],
    [10.81400104, 106.61363473],
    [10.85086822, 106.66312291],
    [10.82270239, 106.62942746],
    [10.77499786, 106.6309953],
    [10.76841465, 106.61687605],
    [10.77446015, 106.65657468],
    [10.7933844, 106.64185857],
    [10.68408575, 106.55215376],
    [10.79737064, 106.62031109],
    [10.77849039, 106.66544494],
]

# Chuyển danh sách dữ liệu thành mảng NumPy
data = np.array(data)
# Áp dụng thuật toán DBSCAN
epsilon = 0.1  # Điều chỉnh giá trị epsilon theo nhu cầu
min_samples = 2  # Điều chỉnh số lượng điểm tối thiểu trong một cụm
dbscan = DBSCAN(
    eps=epsilon,
    min_samples=min_samples,
)
labels = dbscan.fit_predict(data)

# Hiển thị kết quả bằng biểu đồ
core_samples_mask = np.zeros_like(labels, dtype=bool)
core_samples_mask[dbscan.core_sample_indices_] = True

# Chuẩn bị các màu sắc cho từng cụm
unique_labels = set(labels)
colors = [plt.cm.Spectral(each) for each in np.linspace(0, 1, len(unique_labels))]

# Vẽ kết quả
plt.figure(figsize=(8, 6))
for k, col in zip(unique_labels, colors):
    if k == -1:
        col = [0, 0, 0, 1]  # Màu đen cho nhiễu

    class_member_mask = labels == k

    xy = data[class_member_mask & core_samples_mask]
    plt.plot(
        xy[:, 1],
        xy[:, 0],
        "o",
        markerfacecolor=tuple(col),
        markeredgecolor="k",
        markersize=14,
    )

    xy = data[class_member_mask & ~core_samples_mask]
    plt.plot(
        xy[:, 1],
        xy[:, 0],
        "o",
        markerfacecolor=tuple(col),
        markeredgecolor="k",
        markersize=6,
    )

plt.title(f"DBSCAN Clustering (epsilon={epsilon}, min_samples={min_samples})")
plt.xlabel("Longitude")
plt.ylabel("Latitude")
plt.show()
